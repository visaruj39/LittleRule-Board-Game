<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Image Puzzle Game</title>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH"
      crossorigin="anonymous"
    />
    <style>
      body {
        margin: 0;
        padding: 0;
        display: flex;
        justify-content: center;
        align-items: center;
        /* height: 100vh; */
        background: rgb(245, 236, 224);
        background: linear-gradient(
          180deg,
          rgba(245, 236, 224, 1) 90%,
          rgba(255, 255, 255, 1) 100%
        );
        background-repeat: no-repeat;
      }

      #container {
        display: flex;
        flex-wrap: wrap;
        width: 100%;
        max-width: 700px; /* Set a max-width to prevent the container from becoming too large */
        aspect-ratio: 1; /* Maintain a square aspect ratio for the container */
        border: 1px solid #000;
        background-image: url("./anime_img/11.jpg");
        background-size: 100% 100%;
        background-repeat: no-repeat;
        position: relative;
      }

      .piece {
        width: 12.5%; /* Each piece takes up one-eighth of the container's width */
        padding-top: 12.5%; /* Set the height based on the width to maintain a square aspect ratio */
        border: 1px solid #000;
        box-sizing: border-box;
        cursor: pointer;
        display: flex;
        justify-content: center;
        align-items: center;
        font-size: 24px;
        color: white;
        background-color: gray;
        background-size: contain; /* Ensure the background image fully fits within the piece */
        background-repeat: no-repeat;
        background-position: center center;
      }

      .hidden {
        visibility: hidden;
      }

      #scoreboard {
        background-color: rgba(255, 255, 255, 0.7);
        padding: 10px;
        border-radius: 5px;
      }

      @media screen and (max-width: 768px) {
        .piece {
          width: 12.5%; /* On smaller screens, each piece takes up one-eighth of the container's width */
          padding-top: 12.5%; /* Set the height based on the width to maintain a square aspect ratio */
        }
      }
    </style>
  </head>
  <body>
    <div class="container">
      <div class="row">
        <div class="col-12 col-md-6">
          <h1>Image Puzzle Game by LittleRule</h1>
          <div class="container p-0" id="container">
            <!-- Repeat the following div 64 times -->
            <div class="piece" id="piece1">1</div>
            <div class="piece" id="piece2">2</div>
            <div class="piece" id="piece2">3</div>
            <div class="piece" id="piece2">4</div>
            <div class="piece" id="piece2">5</div>
            <div class="piece" id="piece2">6</div>
            <div class="piece" id="piece2">7</div>
            <div class="piece" id="piece2">8</div>
            <div class="piece" id="piece2">9</div>
            <div class="piece" id="piece2">10</div>
            <div class="piece" id="piece2">11</div>
            <div class="piece" id="piece2">12</div>
            <div class="piece" id="piece2">13</div>
            <div class="piece" id="piece2">14</div>
            <div class="piece" id="piece2">15</div>
            <div class="piece" id="piece2">16</div>
            <div class="piece" id="piece2">17</div>
            <div class="piece" id="piece2">18</div>
            <div class="piece" id="piece2">19</div>
            <div class="piece" id="piece2">20</div>
            <div class="piece" id="piece2">21</div>
            <div class="piece" id="piece2">22</div>
            <div class="piece" id="piece2">23</div>
            <div class="piece" id="piece2">24</div>
            <div class="piece" id="piece2">25</div>
            <div class="piece" id="piece2">26</div>
            <div class="piece" id="piece2">27</div>
            <div class="piece" id="piece2">28</div>
            <div class="piece" id="piece2">29</div>
            <div class="piece" id="piece2">30</div>
            <div class="piece" id="piece2">31</div>
            <div class="piece" id="piece2">32</div>
            <div class="piece" id="piece2">33</div>
            <div class="piece" id="piece2">34</div>
            <div class="piece" id="piece2">35</div>
            <div class="piece" id="piece2">36</div>
            <div class="piece" id="piece2">37</div>
            <div class="piece" id="piece2">38</div>
            <div class="piece" id="piece2">39</div>
            <div class="piece" id="piece2">40</div>
            <div class="piece" id="piece2">41</div>
            <div class="piece" id="piece2">42</div>
            <div class="piece" id="piece2">43</div>
            <div class="piece" id="piece2">44</div>
            <div class="piece" id="piece2">45</div>
            <div class="piece" id="piece2">46</div>
            <div class="piece" id="piece2">47</div>
            <div class="piece" id="piece2">48</div>
            <div class="piece" id="piece2">49</div>
            <div class="piece" id="piece2">50</div>
            <div class="piece" id="piece2">51</div>
            <div class="piece" id="piece2">52</div>
            <div class="piece" id="piece2">53</div>
            <div class="piece" id="piece2">54</div>
            <div class="piece" id="piece2">55</div>
            <div class="piece" id="piece2">56</div>
          </div>
        </div>
        <div class="col-12 col-md-6">
          <div class="row mt-sm-3 mt-md-5">
            <div class="col-12">
              <h1 class="text-center" id="countdown"></h1>
            </div>
          </div>
          <div id="scoreboard" class="container mt-3">
            <label for="unitName" class="form-label">leader board</label>
            <table class="table">
              <thead>
                <tr>
                  <th scope="col">#</th>
                  <th scope="col">Name</th>
                  <th scope="col">Score</th>
                  <th scope="col">Actions</th>
                </tr>
              </thead>
              <tbody id="leaderboardBody"></tbody>
            </table>
          </div>
          <div id="scoreboard" class="container mt-sm-3 mt-md-5">
            <label for="unitName" class="form-label">เพิ่มผู้เเข่งขัน</label>
            <input
              type="text"
              class="form-control mb-2"
              id="unitName"
              placeholder="กรุณากรอกชื่อของท่าน"
            />
            <button class="btn btn-primary mt-3" onclick="addPlayer()">
              เพิ่มผู้เล่น
            </button>
          </div>
          <div class="mb-3 text-end">
            <button class="btn btn-primary mt-3" onclick="changeBackground()">
              ภาพต่อไป
            </button>
            <button class="btn btn-primary mt-3" onclick="revealAll()">
              เฉลยจร้า
            </button>
          </div>
        </div>
      </div>
    </div>

    <script>
      let availableImages = []; // Array to store available image filenames
      let changeBackgroundCounter = 0;

      // Function to initialize available images
      function initializeAvailableImages() {
        availableImages = [];
        for (let i = 1; i <= 11; i++) {
          availableImages.push(`${i}.jpg`);
        }
      }

      // Initialize available images
      initializeAvailableImages();
      const container = document.getElementById("container");
      const pieces = document.querySelectorAll(".piece");
      let timer;
      let countdown = 10; // Initial countdown value in seconds
      let previousImage = null; // To store the previously selected image

      // Function to increase the score of a player
      function increaseScore(index) {
        const scoreCell = document.getElementById(`score${index}`);
        let score = parseInt(scoreCell.textContent);
        score++;
        scoreCell.textContent = score;
      }

      // Function to decrease the score of a player
      function decreaseScore(index) {
        const scoreCell = document.getElementById(`score${index}`);
        let score = parseInt(scoreCell.textContent);
        if (score > 0) {
          score--;
          scoreCell.textContent = score;
        }
      }

      // Function to add a player to the leaderboard
      function addPlayer() {
        const unitNameInput = document.getElementById("unitName");
        const playerName = unitNameInput.value.trim();

        // Check if the input field is empty
        if (playerName === "") {
          alert("Please enter a valid player name.");
          return;
        }

        // Create a new row for the leaderboard table
        const leaderboardBody = document.getElementById("leaderboardBody");
        const newRow = document.createElement("tr");
        newRow.innerHTML = `
        <th scope="row">${leaderboardBody.children.length + 1}</th>
        <td>${playerName}</td>
        <td id="score${leaderboardBody.children.length + 1}">0</td>
        <td>
            <button class="btn btn-primary btn-sm" onclick="increaseScore(${
              leaderboardBody.children.length + 1
            })">+</button>
            <button class="btn btn-danger btn-sm" onclick="decreaseScore(${
              leaderboardBody.children.length + 1
            })">-</button>
        </td>
    `;

        // Append the new row to the leaderboard table
        leaderboardBody.appendChild(newRow);

        // Clear the input field after adding the player
        unitNameInput.value = "";
      }

      // Function to get a random image
      function getRandomImage() {
        if (availableImages.length === 0) {
          // If all images have been used, reset the available images
          initializeAvailableImages();
        }

        const randomIndex = Math.floor(Math.random() * availableImages.length);
        const randomImage = availableImages[randomIndex];
        availableImages.splice(randomIndex, 1); // Remove the selected image from available images
        return randomImage;
      }

      // Function to change the background image randomly
      function changeBackground() {
        revealAllRE();
        const randomImage = getRandomImage();
        console.log("randomImage", randomImage);
        container.style.backgroundImage = `url("./anime_img/${randomImage}")`;

        changeBackgroundCounter++; // Increment the counter

        if (changeBackgroundCounter === 11) {
          // Display the Game Over popup after 11 times
          alert("รูปสุดท้ายเเล้วน้าาา");
          changeBackgroundCounter = 0; // Reset the counter
        }
      }
      // Function to reveal the complete image
      function revealImage() {
        this.classList.add("hidden"); // Hide the clicked piece's background
        resetTimer(); // Reset the timer
      }
      function revealAllRE() {
        pieces.forEach((piece) => {
          piece.classList.remove("hidden");
        });
        resetTimer(); // Reset the timer
      }
      // Function to reveal all pieces
      function revealAll() {
        pieces.forEach((piece) => {
          piece.classList.add("hidden");
        });
        resetTimer(); // Reset the timer
      }

      // Function to start the countdown timer
      function startTimer() {
        timer = setInterval(updateCountdown, 1000); // Call updateCountdown function every 1 second
      }

      // Function to update the countdown display
      function updateCountdown() {
        document.getElementById(
          "countdown"
        ).textContent = `เหลือเวลาอีก: ${countdown} วินาที`;
        countdown--;
        if (countdown < 0) {
          clearInterval(timer);
          document.getElementById("countdown").textContent = "หมดเวลา!!!";
        }
      }

      // Function to reset the countdown timer
      function resetTimer() {
        clearInterval(timer); // Clear the current timer
        countdown = 10; // Reset countdown value
        updateCountdown(); // Update countdown display
        startTimer(); // Start a new timer
      }

      // Attach click event listener to each piece
      pieces.forEach((piece) => {
        piece.addEventListener("click", revealImage);
      });

      // Start the timer initially
    </script>
    <script
      src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"
      integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz"
      crossorigin="anonymous"
    ></script>
  </body>
</html>
